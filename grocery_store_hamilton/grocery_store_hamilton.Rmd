---
title: Food Deserts or Food Oases? Predicting Grocery Store Locations in Hamilton, Ontario
author:
  - name: Zehui Yin
    email: yinz39@mcmaster.ca
    affiliation: sees
    correspondingauthor: true
address:
  - code: sees
    organization: School of Earth, Environment & Society, McMaster University
    addressline: 1280 Main Street West
    city: Hamilton
    state: Ontario
    postcode: L8S 4K1
    country: Canada
abstract: |
  This is the abstract.

  It consists of two paragraphs.
keywords: 
  - Grocery Store
  - Hamilton
journal: "GEOG 712 Reproducible Research Workflow with GitHub and R"
date: "`r Sys.Date()`"
linenumbers: false
numbersections: true
bibliography: mybibfile.bib
biblio-style: elsarticle-harv # author year style for natbib - use 'elsarticle-num' or 'elsarticle-num-names' for numbered scheme
classoption: preprint, 3p, authoryear # remove authoryear is not using `elsarticle-harv`
# Use a CSL with `citation_package = "default"`
# csl: https://www.zotero.org/styles/elsevier-harvard
output: 
  rticles::elsevier_article:
    keep_tex: true
    citation_package: natbib
---

```{r, echo=FALSE}
# no code chunk echo or message
knitr::opts_chunk$set(
  echo = F,
  message = F
)
```

```{r}
# load packages
library(sf)
library(tidyverse)
library(geog712package)
library(pscl)
library(units)
```

```{r}
# read data
data("grocery_CT")

# reproject the data
grocery_CT <- st_transform(grocery_CT, crs = 26917)
```

```{r}
# calculate percentage values

# population density
grocery_CT$pop_density <- grocery_CT$v_CA21_1..Population..2021/grocery_CT$v_CA21_7..Land.area.in.square.kilometres

# percentage of people age from 0 - 24
grocery_CT$PCT_aged_under_24 <- (grocery_CT$v_CA21_11..0.to.14.years + 
                                   grocery_CT$v_CA21_89..20.to.24.years)/
  grocery_CT$v_CA21_8..Total...Age*100

# percentage of people aged above 65
grocery_CT$PCT_aged_above_65 <- grocery_CT$v_CA21_251..65.years.and.over/
  grocery_CT$v_CA21_8..Total...Age*100

# percentage of people living in single detached house
grocery_CT$PCT_single_detached <- grocery_CT$v_CA21_435..Single.detached.house/
  grocery_CT$v_CA21_434..Occupied.private.dwellings.by.structural.type.of.dwelling.data*100

# percentage of people married or living common-law
grocery_CT$PCT_married_common_law <- grocery_CT$v_CA21_456..Married.or.living.common.law/
  grocery_CT$v_CA21_453..Marital.status.for.the.total.population.aged.15.years.and.over*100

# percentage of people with income less than 40k
grocery_CT$PCT_income_less_40k <- (grocery_CT$v_CA21_674..Under..10.000..including.loss. + 
                                     grocery_CT$v_CA21_677...10.000.to..19.999 + 
                                     grocery_CT$v_CA21_680...20.000.to..29.999 + 
                                     grocery_CT$v_CA21_683...30.000.to..39.999)/
  grocery_CT$v_CA21_671..With.total.income*100

# percentage of people with income greater than 100k
grocery_CT$PCT_income_greater_100k <- (grocery_CT$v_CA21_707...100.000.to..149.999 + 
                                         grocery_CT$v_CA21_710...150.000.and.over)/
  grocery_CT$v_CA21_671..With.total.income*100

# percentage of population with no knowledge of official language
grocery_CT$PCT_dont_know_official_language <- grocery_CT$v_CA21_1156..Neither.English.nor.French/
  grocery_CT$v_CA21_1144..Knowledge.of.official.languages.for.the.total.population.excluding.institutional.residents*100

# percentage of population who don't speak official language at home
grocery_CT$PCT_not_speak_offcial_language_at_home <- grocery_CT$v_CA21_2176..Non.official.language/
  grocery_CT$v_CA21_2167..All.languages.spoken.at.home.for.the.total.population.excluding.institutional.residents*100
```

```{r}
# construct a contiguity matrix
dist_m <- st_distance(grocery_CT)
dist_m <- drop_units(dist_m)
dist_m[dist_m == 0] <- -999
dist_m[dist_m != -999] <- 0
dist_m[dist_m == -999] <- 1
diag(dist_m) <- 0
```

```{r}
# compute spatial lags
# total number of grocery stores in neighbour CT
grocery_CT$Freq_sum_lag <- dist_m %*% grocery_CT$Freq

# total number of neighbour CT
grocery_CT$n_neighbour <- apply(dist_m, 1, sum)

# row normalize
grocery_CT$Freq_lag <- grocery_CT$Freq_sum_lag/grocery_CT$n_neighbour
```

```{r}
# fit a zero inflated negative binomial regression
m1 <- zeroinfl(Freq ~ Freq_lag,
               data = grocery_CT, dist = "negbin")
summary(m1)
```



















Please make sure that your manuscript follows the guidelines in the 
Guide for Authors of the relevant journal. It is not necessary to 
typeset your manuscript in exactly the same way as an article, 
unless you are submitting to a camera-ready copy (CRC) journal.

For detailed instructions regarding the elsevier article class, see   <https://www.elsevier.com/authors/policies-and-guidelines/latex-instructions>

# Bibliography styles

Here are two sample references: @Feynman1963118 [@Dirac1953888].

By default, natbib will be used with the `authoryear` style, set in `classoption` variable in YAML and with `elsearticle-harv.bst` which is among provided style by `elsarticle` documentclass. Other available style are `elsarticle-num.bst` and `elsarticle-num-names.bst` â€” the first one can be used for the numbered scheme, second one for numbered with new options of natbib.sty. 

You can sets extra options with `natbiboptions` variable in YAML header. Example 
```yaml
natbiboptions: longnamesfirst,angle,semicolon
```

There are various more specific bibliography styles available at
<https://support.stmdocs.in/wiki/index.php?title=Model-wise_bibliographic_style_files>. 
To use one of these, add it in the header using, for example, `biblio-style: model1-num-names`.

## Using CSL 

If `citation_package` is set to `default` in `elsevier_article()`, then pandoc is used for citations instead of `natbib`. In this case, the `csl` option is used to format the references. Alternative `csl` files are available from <https://www.zotero.org/styles?q=elsevier>. These can be downloaded
and stored locally, or the url can be used as in the example header.

# Equations

Here is an equation:
$$ 
  f_{X}(x) = \left(\frac{\alpha}{\beta}\right)
  \left(\frac{x}{\beta}\right)^{\alpha-1}
  e^{-\left(\frac{x}{\beta}\right)^{\alpha}}; 
  \alpha,\beta,x > 0 .
$$

Here is another:
\begin{align}
  a^2+b^2=c^2.
\end{align}

Inline equations: $\sum_{i = 2}^\infty\{\alpha_i^\beta\}$

# Figures and tables

Figure \ref{fig2} is generated using an R chunk.

```{r fig2, fig.width = 5, fig.height = 5, fig.align='center', out.width="50%", fig.cap = "\\label{fig2}A meaningless scatterplot.", echo = FALSE}
plot(runif(25), runif(25))
```

# Tables coming from R

Tables can also be generated using R chunks, as shown in Table \ref{tab1} for example.

```{r tab1, echo = TRUE}
knitr::kable(head(mtcars)[,1:4], 
    caption = "\\label{tab1}Caption centered above table"
)
```

# References {-}

